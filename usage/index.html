
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://nrwldev.github.io/pogo-migrate/usage/">
      
      
        <link rel="prev" href="../why-pogo/">
      
      
        <link rel="next" href="../configuration/">
      
      
      <link rel="icon" href="../favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Usage - Pogo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Pogo" class="md-header__button md-logo" aria-label="Pogo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M448 80v48c0 44.2-100.3 80-224 80S0 172.2 0 128V80C0 35.8 100.3 0 224 0s224 35.8 224 80m-54.8 134.7c20.8-7.4 39.9-16.9 54.8-28.6V288c0 44.2-100.3 80-224 80S0 332.2 0 288V186.1c14.9 11.8 34 21.2 54.8 28.6C99.7 230.7 159.5 240 224 240s124.3-9.3 169.2-25.3M0 346.1c14.9 11.8 34 21.2 54.8 28.6C99.7 390.7 159.5 400 224 400s124.3-9.3 169.2-25.3c20.8-7.4 39.9-16.9 54.8-28.6V432c0 44.2-100.3 80-224 80S0 476.2 0 432z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pogo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Usage
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/NRWLDev/pogo-migrate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pogo-migrate
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pogo" class="md-nav__button md-logo" aria-label="Pogo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M448 80v48c0 44.2-100.3 80-224 80S0 172.2 0 128V80C0 35.8 100.3 0 224 0s224 35.8 224 80m-54.8 134.7c20.8-7.4 39.9-16.9 54.8-28.6V288c0 44.2-100.3 80-224 80S0 332.2 0 288V186.1c14.9 11.8 34 21.2 54.8 28.6C99.7 230.7 159.5 240 224 240s124.3-9.3 169.2-25.3M0 346.1c14.9 11.8 34 21.2 54.8 28.6C99.7 390.7 159.5 400 224 400s124.3-9.3 169.2-25.3c20.8-7.4 39.9-16.9 54.8-28.6V432c0 44.2-100.3 80-224 80S0 476.2 0 432z"/></svg>

    </a>
    Pogo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NRWLDev/pogo-migrate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pogo-migrate
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../why-pogo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why does pogo exist?
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#migrating-from-yoyo" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating from yoyo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      New migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Applying migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marking-a-migration-as-applied" class="md-nav__link">
    <span class="md-ellipsis">
      Marking a migration as applied
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rolling-back-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Rolling back migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rolling back migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marking-a-migration-as-rolled-back" class="md-nav__link">
    <span class="md-ellipsis">
      Marking a migration as rolled back
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-migration-status" class="md-nav__link">
    <span class="md-ellipsis">
      View migration status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Managing migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-a-migration-from-the-dependency-chain" class="md-nav__link">
    <span class="md-ellipsis">
      Remove a migration from the dependency chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#squashing-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Squashing migrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaning-up-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Cleaning up backups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-migration-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Validate migration sql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in python
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../thanks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thanks and Credit
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#migrating-from-yoyo" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating from yoyo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      New migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Applying migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marking-a-migration-as-applied" class="md-nav__link">
    <span class="md-ellipsis">
      Marking a migration as applied
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rolling-back-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Rolling back migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rolling back migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marking-a-migration-as-rolled-back" class="md-nav__link">
    <span class="md-ellipsis">
      Marking a migration as rolled back
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-migration-status" class="md-nav__link">
    <span class="md-ellipsis">
      View migration status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Managing migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-a-migration-from-the-dependency-chain" class="md-nav__link">
    <span class="md-ellipsis">
      Remove a migration from the dependency chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#squashing-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Squashing migrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaning-up-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Cleaning up backups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-migration-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Validate migration sql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in python
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="usage">Usage</h1>
<h2 id="setting-up">Setting up</h2>
<p>To help with getting started, the <code>pogo init</code> command will initialise the
migrations folder, as well as setup the basic configuration for <code>pogo</code>.</p>
<p>Supported flags:</p>
<ul>
<li><code>-m, --migrations-location</code> defines the name of the migrations folder
  (defaults to <code>./migrations</code>)</li>
<li><code>-d, --database-env-key</code> defines the environment variable (or template to
  build from environment variables) for the database dsn. See
  <a href="https://nrwldev.github.io/pogo-migrate/configuration/">configuration</a> for
  examples. For setups running migrations purely in code, this configuration
  can be omitted.</li>
</ul>
<h3 id="migrating-from-yoyo">Migrating from yoyo</h3>
<p>If you are coming here having previously used <code>yoyo</code>, a lot of migrations can
be directly converted to <code>pogo</code> (namely sql migrations). Python migrations will
be copied across as is, and will require manual updating to use async functions.</p>
<p>Supported flags:</p>
<ul>
<li><code>-d, --database</code> postgres dsn to load yoyo history, and store pogo history
  tables.</li>
<li><code>--skip-files, --no-skip-files</code> skip migration files and just copy the yoyo
  history in the database. (defaults to <code>--no-skip-files</code>)</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
</ul>
<p>Locally you will want to migrate files and data, but in a deployed environment
your code will likely already contain the migrated files, and as such just the
database history needs to be copied. In deployed environments <code>--skip-files</code>
would be used.</p>
<h2 id="new-migrations">New migrations</h2>
<p>To create a new migration use <code>pogo new</code>. This will template out the migration
file and open the file in your configured text editor (<code>vi</code> by default).</p>
<p>Supported flags:</p>
<ul>
<li><code>--py</code> generate a python migration (defaults to <code>.sql</code>)</li>
<li><code>--no-interactive</code> skip the editor step and just write the migration template
  to the migrations directory.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>pogo<span class="w"> </span>new<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;a descriptive message&quot;</span>
</span></code></pre></div>
<h2 id="applying-migrations">Applying migrations</h2>
<p>To apply (unapplied) migrations, run <code>pogo apply</code>. Any previously run
migrations will be skipped over, and any new ones will be run in (topological,
based on dependency graph) order.</p>
<p>Supported flags:</p>
<ul>
<li><code>-d, --database</code> optional database dsn to connect to, if not provided will
  fall back to configuration.</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
</ul>
<h3 id="marking-a-migration-as-applied">Marking a migration as applied</h3>
<p>In some scenarios a migration will be added to track changes to the database
that might have been made on the fly as part of a fix. To maintain history and
keep later databases in sync. In this scenario, the migration does not need to
be applied, as such <code>pogo mark</code> will step through unapplied migrations and
confirm which ones to mark as applied.</p>
<ul>
<li><code>-d, --database</code> optional database dsn to connect to, if not provided will
  fall back to configuration.</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
<li><code>--interactive, --no-interactive</code> confirm all changes. (defaults to `--interactive)</li>
</ul>
<h2 id="rolling-back-migrations">Rolling back migrations</h2>
<p>To rollback (applied) migrations, run <code>pogo rollback</code>. By default the most
recently applied migration will be rolled back.</p>
<p>Supported flags:</p>
<ul>
<li><code>-c, --count</code> number of migrations to rollback. (defaults to <code>1</code>)</li>
<li><code>-d, --database</code> optional database dsn to connect to, if not provided will
  fall back to configuration.</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
</ul>
<h3 id="marking-a-migration-as-rolled-back">Marking a migration as rolled back</h3>
<p>To flag a migration as rolled back (without actually rolling back), <code>pogo
unmark</code> will mark a migration as unapplied.</p>
<ul>
<li><code>-d, --database</code> optional database dsn to connect to, if not provided will
  fall back to configuration.</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
</ul>
<h2 id="view-migration-status">View migration status</h2>
<p><code>pogo history</code> will list available migrations. Each migration will be prefixed
with one of U (unapplied) or A (applied), as well as the migration format <code>sql</code> or <code>py</code>.</p>
<ul>
<li><code>--unapplied, --no-applied</code> show only unapplied migrations. (defaults to <code>--no-unapplied</code>)</li>
<li><code>--simple, --no-simple</code> show history as raw data, instead of a pretty printed table. (defaults to <code>--no-simple</code>)</li>
<li><code>-d, --database</code> optional database dsn to connect to, if not provided will
  fall back to configuration.</li>
<li><code>--dotenv, --no-dotenv</code> load environment from local <code>.env</code> file. (defaults to
  <code>--no-dotenv</code>)</li>
</ul>
<p><code>pogo history</code> can be useful in docker containers to prevent start up of an
application until migrations are completed, i.e. checking that there are no
unapplied migrations.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>pogo<span class="w"> </span><span class="nb">history</span><span class="w"> </span>--unapplied<span class="w"> </span>--simple<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</span></code></pre></div>
<h2 id="managing-migrations">Managing migrations</h2>
<p>These commands are mostly experimental and should be used with caution.  They
have been tested on multiple projects but it is likely not all edge cases have
been found yet.  Please raise any issues you find when using them in github.</p>
<h3 id="remove-a-migration-from-the-dependency-chain">Remove a migration from the dependency chain</h3>
<p>Remove a specific migration from the dependency chain. This can be useful to
remove hotfixes or data migrations that are only needed in live environments,
but not in newly deployed environments.</p>
<p>For example a migration to clean up
legacy data is not needed in a fresh environment and can be removed once all
live databases have been updated.</p>
<p>Supported flags:</p>
<ul>
<li><code>-m, --migrations-location</code> defines the name of the migrations folder
  (defaults to configured location)</li>
<li><code>--backup</code> keep any removed files with <code>.bak</code> suffix.</li>
</ul>
<h3 id="squashing-migrations">Squashing migrations</h3>
<p><code>pogo squash</code> will perform a best effort to iterate through all migrations, and
detect where multiple migrations can be condensed into a single migration.</p>
<p>Python migrations and non transaction based transactions are skipped by
default.</p>
<p>Statements in sql migrations are grouped by table, and applied in the order
tables where discovered.</p>
<p>Rollback statements follow the reverse logic, the last table discovered is
grouped first.</p>
<p>Supported flags:</p>
<ul>
<li><code>-m, --migrations-location</code> defines the name of the migrations folder
  (defaults to configured location)</li>
<li><code>--backup</code> keep any removed files with <code>.bak</code> suffix.</li>
<li><code>--source</code> add a comment to each extracted statement with the source
  migration id.</li>
<li><code>--update-prompt</code> prompt before inclusion of an update statement, the
  previous and following statements are included in the prompt. This is helpful
  for removing <code>NULL, update, NOT NULL</code> flows that are not required in a
  squashed migration.</li>
<li><code>--skip-prompt</code> prompt before skipping files that can not be squashed (python
  migrations, non transaction migrations). Allows for removal of unnecessary
  migrations.</li>
</ul>
<h3 id="cleaning-up-backups">Cleaning up backups</h3>
<p><code>pogo clean</code> will remove <code>.bak</code> files created during <code>remove</code> and <code>squash</code>
commands.</p>
<p>Supported flags:</p>
<ul>
<li><code>-m, --migrations-location</code> defines the name of the migrations folder
  (defaults to configured location)</li>
</ul>
<h2 id="validate-migration-sql">Validate migration sql</h2>
<p><code>pogo validate</code> will iterate through all migrations and do a best effort
attempt to validate each sql statement to report any potential issues, like
using reserved keywords as table names without quoting etc.</p>
<p>Supported flags:</p>
<ul>
<li><code>-m, --migrations-location</code> defines the name of the migrations folder
  (defaults to configured location)</li>
</ul>
<h2 id="usage-in-python">Usage in python</h2>
<p>If you want to manage your migrations in python code rather than through the
cli. The migrate module provides the interface required.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pogo_migrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">migrate</span><span class="p">,</span> <span class="n">sql</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">c</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sql</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">database_dsn</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="k">await</span> <span class="n">migrate</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">migrations_dir</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">await</span> <span class="n">migrate</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">migrations_dir</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span>
</span></code></pre></div>
<p>An optional <code>logger</code> parameter can be provided to override the internal logger in both <code>apply()</code> and <code>rollback()</code>.</p>
<p>Alternatively if you already have access to the migrations location and a
database connection (for example from an application framework), the code can
be simplified down to.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pogo_migrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">migrate</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">migrations_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/migrations&quot;</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncpg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">postgres_dsn</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="k">await</span> <span class="n">migrate</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">migrations_dir</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="k">await</span> <span class="n">migrate</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">migrations_dir</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:admin@nrwl.co" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.tracking", "toc.follow"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>